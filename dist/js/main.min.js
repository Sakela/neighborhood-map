function errorMap(){$(".error-map").css("display","block"),$(".error").css("display","block")}function initMap(){"use strict";(map=new google.maps.Map(document.getElementById("map"),{center:{lat:33.7489954,lng:-84.3879824},zoom:13})).onerror=function(){console.log("error")},ko.applyBindings(new ViewModel)}var map,Venue=function(e){"use strict";this.id=e.venue.id,this.name=e.venue.name.toUpperCase(),this.phoneNumber=e.venue.contact.phone,this.address=e.venue.location.address,this.formattedAddress=e.venue.location.formattedAddress,this.categories=e.venue.categories[0].name,this.rating=e.venue.rating,this.url=e.venue.url,this.image=e.venue.photos},ViewModel=function(){"use strict";function e(e){return new google.maps.MarkerImage("http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+e+"|40|_|%E2%80%A2",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34))}function n(e,n){n.setContent('<div class="info-window"><h3>'+e.name+"</h3><p>"+e.vicinity+'</p><a class="info-window-url" href="https://foursquare.com/" target="_blank">Powered By Foursquare <i class="fa fa-foursquare fa-lg" aria-hidden="true"></i></a></div>')}var t=this,o=new google.maps.InfoWindow({maxWidth:350}),s=new google.maps.places.PlacesService(map),a=[],i=(document.getElementById("show-listings"),document.getElementById("hide-listings"),e("8E4E81")),r=e("fc00b5");t.placeList=ko.observableArray([]),t.currentPlace=ko.observable(),t.enableButton=ko.observable(!0),t.searchText=ko.observable(""),t.cityInput=ko.observable("Atlanta"),t.toggleVenues=ko.observable(!0),t.filterMarkers=ko.computed(function(){var e=new RegExp(t.searchText(),"i");a.forEach(function(n){-1!==n.name.search(e)?n.setMap(map):n.setMap(null)})}),t.failEnterKey=function(){return!1},t.searchResults=ko.computed(function(){var e=[],n=new RegExp(t.searchText(),"i");return t.placeList().forEach(function(t){-1!==t.name.search(n)&&e.push(t)}),e}),t.clearFilter=function(){t.searchText(""),t.showListings()},t.setCurrentPlace=function(e){t.currentPlace(e)},t.getDetails=function(e){$.ajax({url:"https://api.foursquare.com/v2/venues/explore?ll="+e.lat+","+e.lng+"&client_id=RG0BDGPCIXRYCKU3MGO2K4NSMZQMEZG3PVX1IEQQ1W5V5OMF&client_secret=1OVPLSTAD3E0PNUHRMZVSFC24NJS0YATRZSTZ0BCWGPU5AKU&v=20170919&venuePhotos=1",success:function(e){e.response.groups[0].items.forEach(function(e){t.createMarker(e),t.getPhotos(e)})},error:function(e,n,t){$(".error").css("display","block")}})},t.getPhotos=function(e){$.ajax({url:"https://api.foursquare.com/v2/venues/"+e.venue.id+"/photos?limit=1&client_id=RG0BDGPCIXRYCKU3MGO2K4NSMZQMEZG3PVX1IEQQ1W5V5OMF&client_secret=1OVPLSTAD3E0PNUHRMZVSFC24NJS0YATRZSTZ0BCWGPU5AKU&v=20130815",dataType:"jsonp",success:function(n){if(200===n.meta.code)if(void 0!==n.response.photos.items[0]){o="https://irs3.4sqi.net/img/general/width100"+n.response.photos.items[0].suffix;e.venue.photos=o,t.placeList.push(new Venue(e))}else{o="http://www.freeiconspng.com/uploads/no-image-icon-10.png";e.venue.photos=o,t.placeList.push(new Venue(e))}else{var o="http://www.freeiconspng.com/uploads/no-image-icon-10.png";e.venue.photos=o,t.placeList.push(new Venue(e)),$(".error-image").css("display","block")}},error:function(e,n,t){$(".error").css("display","block"),$(".error-image").css("display","block")}})},t.searchCity=function(e){var n={query:e};s.textSearch(n,function(e,n){if(n==google.maps.places.PlacesServiceStatus.OK){if(n==google.maps.places.PlacesServiceStatus.OK){$(".error-search").css("display","none");var o={};o.lat=e[0].geometry.location.lat(),o.lng=e[0].geometry.location.lng();var s=new google.maps.LatLng(e[0].geometry.location.lat(),e[0].geometry.location.lng());map.setCenter(s),t.getDetails(o)}}else $(".error-search").css("display","block")})},t.searchCity(t.cityInput()),t.cityChanger=function(){t.hideListings(),a.length=0,t.placeList().length=0,t.searchCity(t.cityInput())},t.bindPlaceMarker=function(e){t.setCurrentPlace(e),window.innerWidth<400&&t.toggleList(),t.searchText(e.name),a.forEach(function(s){e.id===s.id?null!==s.map&&(n(s,o),o.open(map,s),t.setHighlightedMarkerIcon(s),map.setCenter(s.getPosition()),map.setZoom(16)):s.setMap(null)})},t.createMarker=function(e){var s=new google.maps.LatLng(e.venue.location.lat,e.venue.location.lng),r=new google.maps.Marker({map:null,position:s,animation:google.maps.Animation.DROP,icon:i,name:e.venue.name,id:e.venue.id,vicinity:e.venue.location.address});google.maps.event.addListener(r,"click",function(){a.forEach(function(e){r.id===e.id?(t.setHighlightedMarkerIcon(r),n(r,o),o.open(map,r),t.searchText(r.name),map.setCenter(r.getPosition()),map.setZoom(16)):e.setMap(null)})}),a.push(r),t.showListings()},t.setHighlightedMarkerIcon=function(e){a.forEach(function(e){e.setIcon(i)}),e.setIcon(r)},t.showListings=function(){for(var e=new google.maps.LatLngBounds,n=0;n<a.length;n++)a[n].setMap(map),o.close(map,this),e.extend(a[n].position);map.fitBounds(e),t.enableButton(!1)},t.hideListings=function(){for(var e=0;e<a.length;e++)a[e].setMap(null);t.enableButton(!0)},google.maps.event.addDomListener(window,"resize",function(){t.showListings()})};